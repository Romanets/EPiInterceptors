//>>built
define("epi/shell/store/JsonRest",["dojo","dojo/store/JsonRest","epi/shell/XhrWrapper"],function(_1,_2,_3){return _1.declare("epi.shell.store.JsonRest",[_2],{xhrHandler:null,idAttribute:"id",preventCache:false,constructor:function(_4){if(!this.xhrHandler){this.xhrHandler=new _3();}},get:function(id,_5){var _6=_5||{};_6.Accept="application/javascript, application/json";var _7=typeof id!="undefined";var _8={url:_7?this.target+id:this.target,handleAs:"json",headers:_6,preventCache:this.preventCache};return this.xhrHandler.xhrGet(_8);},put:function(_9,_a){_a=_a||{};var _b={"Content-Type":"application/json","If-Match":_a.overwrite===true?"*":null,"If-None-Match":_a.overwrite===false?"*":null};var id=("id" in _a)?_a.id:this.getIdentity(_9);var _c=typeof id!="undefined";if(_c&&!_a.incremental){_b["X-Http-Method-Override"]="PUT";}var _d={url:_c?this.target+id:this.target,postData:_1.toJson(_9),handleAs:"json",headers:_b,xsrfProtection:true};return this.xhrHandler.xhr("POST",_d);},patch:function(_e,_f){var _10=_f||{};_10.Accept="application/javascript, application/json";_10["X-Http-Method-Override"]="PATCH";_10["Content-Type"]="application/json";var id=("id" in _f)?_f.id:this.getIdentity(_e);var _11=typeof id!="undefined";var _12={url:_11?this.target+id:this.target,postData:_1.toJson(_e),handleAs:"json",headers:_10,xsrfProtection:true};return this.xhrHandler.xhr("POST",_12);},remove:function(id,_13){var _14={};_14.Accept="application/javascript, application/json";_14["Content-Type"]="application/json";_14["X-Http-Method-Override"]="DELETE";_13=_13||{};return this.xhrHandler.xhr("POST",{url:this.target+id,headers:_14,postData:_1.toJson(_13),handleAs:"json",xsrfProtection:true});},query:function(_15,_16){var _17={Accept:"application/javascript, application/json"};var _18;_16=_16||{};if(_16.start>=0||_16.count>=0){_17.Range="items="+(_16.start||"0")+"-"+(("count" in _16&&_16.count!=Infinity)?(_16.count+(_16.start||0)-1):"");}if(_1.isObject(_15)){if(_15[this.idAttribute]){_18=_15[this.idAttribute];_15[this.idAttribute]=null;}_15=_1.objectToQuery(_15);_15=_15?"?"+_15:"";}if(_16&&_16.sort){_15+=(_15?"&":"?")+"sort(";for(var i=0;i<_16.sort.length;i++){var _19=_16.sort[i];_15+=(i>0?",":"")+(_19.descending?"-":"+")+encodeURIComponent(_19.attribute);}_15+=")";}var _1a=this.xhrHandler.xhrGet({url:this.target+(_18||"")+(_15||""),handleAs:"json",headers:_17,preventCache:this.preventCache});_1a.total=_1a.then(function(){var _1b=_1a.ioArgs.xhr.getResponseHeader("Content-Range");return _1b&&(_1b=_1b.match(/\/(.*)/))&&+_1b[1];});return _1.store.util.QueryResults(_1a);},move:function(id,_1c,_1d){return this._send("MOVE",id,_1c,_1d);},copy:function(id,_1e,_1f){return this._send("COPY",id,_1e,_1f);},executeMethod:function(_20,id,_21,_22){var _23=_22||{};_23.Accept="application/javascript, application/json";_23["Content-Type"]="application/json";_23["X-Http-Method-Override"]=_20;_21=_21||{};return this.xhrHandler.xhr("POST",{url:this.target+id,headers:_23,postData:_1.toJson(_21),handleAs:"json",xsrfProtection:true});},_send:function(_24,id,_25,_26){var _27=_26||{};_27.Accept="application/javascript, application/json";_27["X-Http-Method-Override"]=_24;var _28=_1.isObject(_25)?_25:{targetId:_25};return this.xhrHandler.xhr("POST",{url:this.target+id,headers:_27,content:_28,handleAs:"json",xsrfProtection:true});}});});