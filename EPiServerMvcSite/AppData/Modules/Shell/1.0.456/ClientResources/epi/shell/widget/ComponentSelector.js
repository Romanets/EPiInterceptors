//>>built
define("epi/shell/widget/ComponentSelector",["epi","dojo","dojo/_base/array","dojo/_base/lang","dijit","dojox","dijit/_Contained","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/MenuItem","dijit/layout/ContentPane","dijit/layout/BorderContainer","dijit/form/Button","dijit/form/TextBox","dijit/form/Form","dojox/grid/DataGrid","dojo/data/ObjectStore","dojo/store/JsonRest","dojo/store/Memory","epi/routes","epi/i18n!epi/shell/ui/nls/EPiServer.Shell.UI.Resources.ComponentSelection","epi/dependency"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,res,_16){var _17=_2.declare("epi.shell.widget.ComponentSelector",[_8,_9,_a,_7],{templateString:"            <div>            <div class=\"dijitDialogPaneToolBar clearfix\">                    <div class=\"dijitDialogPaneLeading\">                    </div>                    <div class=\"dijitDialogPaneTrailing\">                        <input dojoType=\"dijit.form.TextBox\" dojoAttachPoint=\"searchBox\" dojoAttachEvent=\"onKeyUp: _onSearchBoxChange, onKeyPress: _onSearchBoxPress\" placeHolder=\"${commonRes.action.search}\" class=\"epi-searchInput\" />                    </div>                </div>                <div class=\"dijitDialogPaneContentArea epi-wrapped\">                    <div dojoType=\"dijit.layout.BorderContainer\" dojoAttachPoint=\"container\" style=\"width: 100%; height: 330px;\">                        <div dojoType=\"dijit.layout.ContentPane\" region=\"leading\" splitter=\"false\" class=\"epi-dialog-resourcePane epi-dijitMenuDisableIcon\" style=\"width: 160px;\" >                            <div dojoType=\"dijit.Menu\" dojoAttachPoint=\"categoryMenu\" dojoAttachEvent=\"onItemClick: _onCategoryMenuClick\" style=\"width:160px;\"></div>                        </div>                        <table dojoType=\"dojox.grid.DataGrid\" dojoAttachEvent=\"onRowClick: _onGridRowSelected\" dojoAttachPoint=\"grid\" selectionMode=\"none\" height=\"330px\" region=\"center\" clientSort=\"true\" queryOptions=\"{ignoreCase:true}\">                            <thead>                                <tr>                                    <th field=\"title\" formatter=\"epi.shell.widget.ComponentSelector.titleFormatter\" width=\"50%\">${commonRes.header.name}</th>                                    <th field=\"name\" width=\"7%\" formatter=\"epi.shell.widget.ComponentSelector.actionButtonFormatter\">&nbsp;</th>                                </tr>                            </thead>                        </table>                    </div>                </div>                <div class=\"dijitDialogPaneActionBar\">                    <button data-dojo-type=\"dijit.form.Button\" type=\"submit\" data-dojo-props=\"'class':'default'\" data-dojo-attach-event=\"onClick:onClose\">${commonRes.action.done}</button>                </div>             </div>",res:res,commonRes:_1.resources,plugInArea:"*",selectedCategory:"*",componentCategory:null,_selectedCategoryMenuItem:null,categoryStore:null,componentDefinitionStore:null,_sortableColumns:[1],postMixInProperties:function(){this.inherited(arguments);this.categoryStore=this.categoryStore||this._getStore("epi.shell.componentcategory");this.componentDefinitionStore=this.componentDefinitionStore||this._getStore("epi.shell.componentdefinition");},postCreate:function(){this.inherited(arguments);this.grid.canSort=_4.hitch(this,this._canSort);},_canSort:function(_18){return _2.some(this._sortableColumns,function(_19){return _19==Math.abs(_18);});},_getStore:function(_1a){var _1b=_16.resolve("epi.storeregistry");return _1b.get(_1a);},onComponentSelected:function(){},onClose:function(){},_onGridRowSelected:function(row){var _1c=this.grid.getItem(row.rowIndex);var _1d=this.grid.store.getValue(_1c,"componentDefinition");this.onComponentSelected(_1d);},dataBind:function(_1e){if(this.grid.store!==null&&_1e!==true){return;}if(_1e){_3.forEach(this.categoryMenu.getChildren(),function(_1f){this.categoryMenu.removeChild(_1f);},this);}this.grid.formatterScope=this;var _20=this.grid;_2.when(this.componentDefinitionStore.query(),_4.hitch(this,function(_21){var _22=_3.filter(_21,function(_23){return this._inCategoryFilter(_23.categories);},this);this._populateCategoryMenu(_22);var _24=new _14({data:_22});var _25=new _12({objectStore:_24});_20.setStore(_25);}));},show:function(_26){this.inherited(arguments);this.dataBind(_26);this.resize();},resize:function(){this.inherited(arguments);this.container.resize();this.grid.resize();},_populateCategoryMenu:function(_27){this._selectedCategoryMenuItem=new _b({label:this.commonRes.header.all,selected:true,value:"*"});this.categoryMenu.addChild(this._selectedCategoryMenuItem);var _28=this.categoryStore.query();_2.when(_28,_4.hitch(this,function(_29){_3.forEach(_29,function(_2a){var _2b=_3.some(_27,function(_2c){return _3.indexOf(_2c.categories,_2a.name)>=0;});if(_2b){this.categoryMenu.addChild(new _b({label:_2a.displayName,value:_2a.name}));}},this);}));},_inCategoryFilter:function(_2d){var _2e=this.componentCategory;return _2e==null||_3.some(_2d,function(c){return _2e===c;});},_onCategoryMenuClick:function(_2f,e){this._selectedCategoryMenuItem.set("selected",false);_2f.set("selected",true);this._selectedCategoryMenuItem=_2f;this.selectedCategory=_2f.value;this.searchBox.reset();this.grid.filter({title:"*",categories:"*"+this.selectedCategory+"*",plugInArea:this.plugInArea});},_onSearchBoxChange:function(e){var _30=this.searchBox.attr("value");if(_30.length===0){_30="*";}else{_30="*"+_30+"*";}this.grid.filter({title:_30,categories:"*"+this.selectedCategory+"*",plugInArea:this.plugInArea});return false;},_onSearchBoxPress:function(e){if(e.charOrCode==_2.keys.ENTER){_2.stopEvent(e);}return;}});_17.actionButtonFormatter=function(_31,_32){var _33=this.grid.getItem(_32);var _34=this.grid.store.getValue(_33,"componentDefinition");return new _e({title:this.res.addgadgetstitle,showLabel:false,baseClass:"epi-chromelessButton",iconClass:"epi-addIcon",onClick:function(){return false;}});};_17.titleFormatter=function(_35,_36,_37){var _38=this.grid.getItem(_36);if(_38.description!=null){var _39=_38.description;if(typeof _39=="string"){return "<span title=\""+_39+"\">"+_35+"</span>";}}return _35;};return _17;});