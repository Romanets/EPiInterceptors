//>>built
define("epi/shell/MetadataTransformer",["dojo","dojo/_base/lang","dojo/_base/array","epi","dojo/store/Memory","epi/string"],function(_1,_2,_3,_4,_5,_6){return _1.declare("epi.shell.MetadataTransformer",[],{defaultGroupType:"epi.shell.widget.GroupContainerLayout",defaultSingleGroupType:"epi.shell.widget.ContainerLayout",defaultParentType:"epi.shell.widget.ParentContainerLayout",defaultGroupName:"defaultGroup",propertyFilter:null,constructor:function(_7){_2.mixin(this,_7);},toComponentDefinitions:function(_8,_9,_a,_b){var _c=this._filterProperties(_8);var _d=this._getComponentDefinitions(_c,_8.groups,_9,_a,_b);return _d;},_filterProperties:function(_e){var _f=_2.isFunction(this.propertyFilter)?_2.hitch(this,function(_10){return this.propertyFilter(_e,_10);}):function(){return true;},_11=_3.filter(_e.properties,_f);return _11;},_getComponentDefinitions:function(_12,_13,_14,_15,_16){var _17=[],_18=_2.clone(_13)||[],_19=_2.clone(_12)||[],_1a=function(_1b,_1c){return (_1b.displayOrder||0)-(_1c.displayOrder||0);};_18.sort(_1a);_19.sort(_1a);_3.forEach(_18,_2.hitch(this,function(_1d){var _1e=this._createGroupContainer(_1d,_16);_17.push(_1e);}));_3.forEach(_19,_2.hitch(this,function(_1f){if(!_1f.showForEdit){return;}var _20=_1f.properties&&_1f.properties.length?this._createParentContainer(_1f,_14,_15,_16):this._createPropertyWidget(_1f,_14,_15,_16);var _21=_3.some(_17,_2.hitch(this,function(_22){if(_22.settings.name===_6.pascalToCamel(_1f.groupName||this.defaultGroupName)){_22.components.push(_20);return true;}return false;}));if(!_21){var _23=this._createGroupContainer({name:this.defaultGroupName,title:this.defaultGroupName,displayUI:true},_16);_23.components.push(_20);_17=[_23].concat(_17);}}));var _24=_3.filter(_17,function(_25){return _25.settings.displayui&&_25.components&&_25.components.length;});var _26=(_24.length>1)?this.defaultGroupType:this.defaultSingleGroupType;_3.forEach(_24,_2.hitch(this,function(_27){_27.widgetType=_27.widgetType||_26;}));return _24;},_createGroupContainer:function(_28,_29){var _2a={_type:"group",name:_6.pascalToCamel(_28.name),label:_28.title,readOnly:_29,displayui:_28.displayUI};return {settings:_2.mixin(_2a,_28.options),widgetType:_28.uiType,components:[]};},_createParentContainer:function(_2b,_2c,_2d,_2e){var _2f={_type:"parent",name:_2c+_6.pascalToCamel(_2b.name),label:_2b.displayName};var _30=this._filterProperties(_2b);return {settings:_2.mixin(_2f,_2b.settings),widgetType:_2b.layoutType||this.defaultParentType,components:this._getComponentDefinitions(_30,_2b.groups,_2f.name+".",_2d,_2e)};},_createPropertyWidget:function(_31,_32,_33,_34){var _35=_2.mixin(_33?{value:_31.defaultValue}:{},{_type:"field",name:_32+_6.pascalToCamel(_31.name),label:_31.displayName,selections:_31.selections,displayui:_31.displayui,readOnly:_34},_31.settings);return {settings:_35,widgetType:_31.uiType,widgetPackage:_31.uiPackage};}});});