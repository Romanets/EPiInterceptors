//>>built
require({cache:{"url:epi/shell/widget/templates/IframeWithOverlay.html":"<div data-dojo-attach-point=\"containerNode\" class=\"epi-editorViewport\">\r\n    <div data-dojo-attach-point=\"scroller\" class=\"epi-editorViewport-center\">\r\n        <div data-dojo-attach-point=\"previewContainer\" class=\"epi-editorViewport-previewBox\"  data-dojo-props=\"region: 'center'\">\r\n            <iframe data-dojo-attach-point=\"iframe\" data-dojo-type=\"epi.local.AutoResizingIframe\" data-dojo-props=\"autoFit : false\"></iframe>\r\n            <div data-dojo-attach-point=\"overlay\" data-dojo-type=\"epi.shell.widget.overlay.OverlayContainer\"></div>\r\n            <div data-dojo-attach-point=\"scrollSizer\" class=\"epi-editorViewport-scrollSizer\"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n"}});define("epi/shell/widget/IframeWithOverlay",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","dojo/number","dojo/on","dojo/aspect","dojo/dom-geometry","dojo/dom-style","dojo/dom-construct","dojo/dom-class","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/Url","./Iframe","./_AutoResizingIframeMixin","./_ScrollbarMeasurementMixin","./_DynamicStyleSheetIframeMixin","./overlay/OverlayContainer","epi/shell/layout/_LayoutWidget","epi/shell/widget/DelayableStandby","dojo/text!./templates/IframeWithOverlay.html"],function(_1,_2,_3,_4,_5,on,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15){_1("epi.local.AutoResizingIframe",[_e,_f,_11]);return _1("epi.shell.widget.IframeWithOverlay",[_13,_b,_c,_10],{templateString:_15,autoResize:true,previewSize:null,previewClass:"",standbySettings:{delayTime:3000,duration:350},postCreate:function(){this.inherited(arguments);this.overlay.set("target",this.iframe);this._setupStandby();this.connect(this.iframe,"onLoading",function(){this._standby.show();});this.connect(this.iframe,"onLoad",function(){_a.toggle(this.scroller,"epi-editorViewport-preview-external",!this.iframe.isInspectable());if(this._pendingLayout){this._pendingLayout=false;this.layout();}this._standby.hide();setTimeout(_2.hitch(this,function(){this._setCenterViewport(this._availableViewport||this._contentBox||_7.getContentBox(this.containerNode),true);},50));});},startup:function(){if(this._started){return;}this.inherited(arguments);this._setCenterViewport(this._availableViewport||this._contentBox||_7.getContentBox(this.containerNode),true);},unitialize:function(){this._standby.destroy();this._standby=null;},addChild:function(_16,_17){function _18(){this.layout();_3.forEach(_16.getDescendants(),function(_19){_19.connect(_19,"onLayoutChanged",_2.hitch(this,function(){if(_16.open){this.layout();}}));},this);};function _1a(){this._resetScroll();_8.set(this.scroller,{width:""});this._setCenterViewport(this._contentBox);};_16.connect(_16,"onAfterShow",_2.hitch(this,_18));_16.connect(_16,"onAfterHide",_2.hitch(this,_1a));this.connect(this,"onLayoutChanged",_2.hitch(this,function(){if(_16.open){this.scrollIntoView(_16.overlayItem);}}));this.inherited(arguments);},layout:function(_1b){if(this.iframe.isLoading||!this._contentBox){this._pendingLayout=true;return;}this._layoutChildren(_1b);this.inherited(arguments);},_layoutChildren:function(_1c){this._positionChildren();this._setCenterViewport(this._availableViewport,_1c);},_positionChildren:function(){var _1d=this.get("centerSize");this._availableViewport=_2.mixin({},this._contentBox);_8.set(this.scroller,{width:""});var _1e=this.getScrollbars(this.scroller);_3.forEach(this.getChildren(),function(_1f){if(_1f===this.iframe||_1f===this.overlay||_1f.open===false||_1f.visible===false){return;}var _20;switch(_1f.region){case "leading":if(_1f.resize){_1f.resize({t:0,l:0,h:this._contentBox.h-_1e.x});}_20=_7.position(_1f.domNode);this._availableViewport.w-=_20.w;this._availableViewport.l+=_20.w;break;case "trailing":var _21=_2.hitch(this,function(){if(_1f.resize){if(!_1f._computedStyle){_1f._computedStyle=_8.getComputedStyle(_1f.domNode);}_20=_7.getMarginBox(_1f.domNode,_1f._computedStyle);_1f.resize({t:0,h:this._contentBox.h-_1e.x});_8.set(_1f.domNode,{right:_1e.y+"px"});_8.set(this.scroller,{width:(this._availableViewport.w-_20.w)+"px"});this._availableViewport.w-=_20.w+_1e.y;}});_21();break;case "center":if(_1f.resize){_1f.resize(_1d);}break;default:break;}},this);},_setCenterViewport:function(_22,_23){var _24=this.get("centerSize")||_7.getContentBox(this.previewContainer),_25,top,_26,_27=this;this.previewContainer._computedStyle=this.previewContainer._computedStyle||_8.getComputedStyle(this.previewContainer);_25=_7.getPadBorderExtents(this.previewContainer,this.previewContainer._computedStyle);top=_22.h>_24.h?_5.round((_22.h-_24.h)/2):0;_26=_22.w>_24.w?_5.round((_22.w-_24.w)/2):0;_8.set(this.previewContainer,{top:top-_25.t+"px",left:_26-_25.l+"px",width:_24.w+"px",height:_24.h+"px"});this.iframe.resize(_24,!!_23).then(function(){_8.set(_27.previewContainer,{overflow:"hidden"});setTimeout(function(){_8.set(_27.previewContainer,{overflow:"auto"});},10);});},scrollIntoView:function(_28){var _29,_2a,_2b,_2c=16;if(this.iframe.isLoading||!this._contentBox){return;}this._layoutChildren();if((!this.autoResize&&this.previewSize.w<this._availableViewport.w)){return;}_29=_28.get("position");_2a=_29.x+_29.w+_2c-this.scroller.scrollLeft-this._availableViewport.w;_2b=this.previewContainer.clientWidth+_2a;_8.set(this.scrollSizer,{width:_2b+"px"});this.previewContainer.scrollLeft=_2a;this._positionChildren(this.get("centerSize"));},_resetScroll:function(){_8.set(this.scrollSizer,{width:"1px"});},_setupStandby:function(){var _2d=_2.mixin(this.standbySettings,{target:this.scroller});this._standby=new _14(_2d).placeAt(this.domNode,"last");this._standby.startup();},_getCenterSizeAttr:function(){return this.previewSize||this._contentBox;},_setPreviewSizeAttr:function(_2e){this.autoResize=!_2e;this.previewSize=_2e;_a.toggle(this.scroller,"epi-editorViewport-preview",!this.autoResize);this.layout();},_setPreviewClassAttr:function(_2f){if(_2f){_a.replace(this.scroller,_2f,this.previewClass);}else{_a.remove(this.scroller,this.previewClass);}this._set("previewClass",_2f);}});});