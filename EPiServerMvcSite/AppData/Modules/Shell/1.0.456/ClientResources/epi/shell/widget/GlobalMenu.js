//>>built
require({cache:{"url:epi/shell/widget/templates/GlobalMenu.html":"<div>\r\n    <div data-dojo-attach-point=\"accordionNode\" class=\"epi-navigation-accordioncontainer\">\r\n        <div data-dojo-attach-point=\"containerNode\" style=\"position:absolute; bottom:0; left:0; width:100%\"></div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"expandCollapseContainer\" class=\"epi-navigation-expandcollapseContainer\">\r\n        <a data-dojo-attach-point=\"expandCollapseButton\" href=\"javascript:void(0)\" class=\"epi-navigation-expandcollapseBtn\"\r\n            tabindex=\"0\"><span class=\"epi-navigation-expandcollapseIcon\"></span></a>\r\n    </div>\r\n</div>\r\n"}});define("epi/shell/widget/GlobalMenu",["dojo","dojo/fx","dojo/fx/easing","dojo/query","dojo/NodeList-traverse","dojo/dom-style","dojo/dom-class","dojo/text!./templates/GlobalMenu.html","dijit/focus","dijit/_Container","dijit/_TemplatedMixin","dijit/_Widget","epi/Url","epi/i18n!epi/shell/ui/nls/EPiServer.Shell.UI.Resources.GlobalMenu","epi/shell/messaging"],function(_1,fx,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e){return _1.declare("epi.shell.widget.GlobalMenu",[_b,_a,_9],{animateDuration:300,res:_d,templateString:_7,_menuDomNode:null,_focusNode:null,_expandCollapseNode:null,_isShown:true,_siteUrl:null,postCreate:function(){this.inherited(arguments);this._focusNode=_1.query(".epi-navigation-selected > a",this.containerNode)[0];this.connect(this,"onBlur",this._hideMenu);this.connect(this.domNode,"onmouseenter",this._toggleHintOn);this.connect(this.domNode,"onmouseleave",this._toggleHintOff);this.connect(this.accordionNode,"onclick",this._showMenu);this.connect(this.expandCollapseContainer,"onclick",this._toggleMenu);this.resize();this._hideMenu();_1.subscribe("/epi/shell/context/changed",_1.hitch(this,"_onContextChanged"));_e.subscribe("/epi/shell/globalnavigation/layoutchange",null,_1.hitch(this,this.resize));},resize:function(){var h=this._getContentHeight();_5.set(this.accordionNode,"height",h+"px");},_getContentHeight:function(){return _1.contentBox(this.containerNode).h;},_toggleMenu:function(e){if(this._isShown){this._hideMenu();}else{this._showMenu();}_1.stopEvent(e);},_toggleHintOn:function(){if(this._isShown){return;}if(this._animation){this._animation.stop();}_5.set(this.containerNode,"display","");this._animation=_1.animateProperty({node:this.accordionNode,duration:400,properties:{height:6}}).play();},_toggleHintOff:function(){if(this._isShown){return;}if(this._animation){this._animation.stop();}this._animation=_1.animateProperty({node:this.accordionNode,duration:200,onEnd:_1.hitch(this,function(){_5.set(this.containerNode,"display","none");}),properties:{height:0.01}}).play();},_showMenu:function(){if(this._isShown){return;}this._isShown=true;_5.set(this.containerNode,"display","");_1.animateProperty({node:this.accordionNode,duration:this.animateDuration,easing:_2.backOut,properties:{height:this._getContentHeight()},beforeBegin:_1.hitch(this,function(){_6.add(this.domNode,"epi-globalNavigation-open");}),onEnd:_1.hitch(this,function(){_8.focus(this._focusNode);})}).play();},_hideMenu:function(){if(!this._isShown){return;}this._isShown=false;_1.animateProperty({node:this.accordionNode,duration:this.animateDuration,easing:_2.backIn,properties:{height:0.01},onEnd:_1.hitch(this,function(){_6.remove(this.domNode,"epi-globalNavigation-open");_5.set(this.containerNode,{display:"none"});})}).play();},_getToViewModeElement:function(){var _f=_1.query(".epi-navigation-global")[0];var _10=_1.query(".epi-navigation-container-utils",this.element)[0];return _1.query(".epi-navigation-global_sites.epi-navigation-currentSite.epi-navigation-iconic",_10)[0];},_onContextChanged:function(ctx,_11){var _12=this._getToViewModeElement();if(_12==null){return;}var url=this._buildPublicUrl(ctx,_12);var _13=_1.replace(this.res.toviewmode,[url.toString()]);_1.attr(_12,{href:ctx.versionedUrl===""?url.path:ctx.versionedUrl,title:_13});},_buildPublicUrl:function(ctx,_14){if(this._siteUrl==null){this._siteUrl=_14.href;}var _15=new _c(this._siteUrl);var _16=window.location;var _17={scheme:_16.protocol,authority:_16.host,path:ctx.capabilities.isBlock===true||ctx.publicUrl===""?_15.path:ctx.publicUrl};var url=new _c(null,_17,true);return url;}});});