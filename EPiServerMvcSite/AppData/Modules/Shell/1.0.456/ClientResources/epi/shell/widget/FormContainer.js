//>>built
define("epi/shell/widget/FormContainer",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/_base/Deferred","dojo/_base/connect","dojo/dom-geometry","dojo/dom-style","dojo/aspect","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Form","epi/epi","epi/dependency","epi/string","epi/shell/widget/WidgetFactory","epi/shell/MetadataTransformer"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11){return _1("epi.shell.widget.FormContainer",[_9,_a,_b],{templateString:"<div class=\"epi-formContainer\">                            <div data-dojo-type=\"dijit.form.Form\" class=\"epi-formArea\" data-dojo-attach-point=\"form\">                            </div>                         </div>",value:null,metadata:null,propertyFilter:null,defaultContainerWidget:"epi.shell.widget.ContainerLayout",readOnly:false,_widgetMap:null,_uiSetUp:false,_watchHandles:[],postMixInProperties:function(){this.inherited(arguments);this._widgetMap={};},startup:function(){this.inherited(arguments);this._setupUI();},destroy:function(){this.totalResizeConnections=0;_2.forEach(this._watchHandles,function(_12){_12.unwatch();});if(this.containerLayout){this.containerLayout.destroyRecursive();}this.inherited(arguments);},_getValueAttr:function(){return this.form.get("value");},_setValueAttr:function(_13){if(this._formCreated){this.form.set("value",_13);}this._set("value",_13);},onGroupCreated:function(_14,_15){},onChange:function(_16){},onFieldCreated:function(_17,_18){},_onFormCreated:function(_19){if(_d.isEmpty(this.get("value"))){this._onChange();}this.onFormCreated(_19);},onFormCreated:function(_1a){},_setupUI:function(){var _1b=new _10();var _1c=new _11({propertyFilter:this.propertyFilter});_4.when(this.metadata,_3.hitch(this,function(_1d){var _1e=_1d.layoutType||this.defaultContainerWidget;require([_f.slashName(_1e)],_3.hitch(this,function(_1f){this.containerLayout=new _1f();this.containerLayout.placeAt(this.form.domNode);this._uiSetUp=false;var _20=!this.value;var _21=_1c.toComponentDefinitions(_1d,"",_20,this.readOnly);var _22=[],_23=[];_22.push(this.containerLayout);this.connect(_1b,"onWidgetCreated",_3.hitch(this,function(_24,_25){var _26=_22[_22.length-1];var _27=_23.length?_23[_23.length-1]:null;this._widgetMap[_24.id]={parent:_26,group:_27};this._watchHandles.push(this.watch("readOnly",_3.hitch(this,function(_28,_29,_2a){_24.set("readOnly",_2a);})));if(_25.settings._type==="field"){_24.set("editMode","createcontent");this.connect(_24,"onChange","_onChange");_8.before(_24,"focus",_3.hitch(this,function(){this._beforeSetFocus(_24);}));this.onFieldCreated(_25.settings.name,_24);}else{if(_25.settings._type==="group"){_23.push(_24);this.onGroupCreated(_25.settings.name,_24);}else{if(_25.settings._type==="parent"){_22.push(_24);}}}}));this.connect(_1b,"onWidgetHierarchyCreated",_3.hitch(this,function(_2b,_2c){if(_2c.settings._type==="group"){_23.pop();}else{if(_2c.settings._type==="parent"){_22.pop();}}}));_4.when(_1b.createWidgets(this.containerLayout,_21),_3.hitch(this,function(){this._formCreated=true;this.form.connectChildren();this.set("value",this.value||{});this.containerLayout.startup();this._uiSetUp=true;this._onFormCreated(this);}));this._watchHandles.push(this.form.watch("state",_3.hitch(this,function(_2d,_2e,_2f){this.set("state",_2f);})));}));}));},_onChange:function(){if(!this._uiSetUp){return;}var _30=this.form.get("value");if(!_d.areEqual(this.value,_30)){this.value=_30;this.onChange(_30);}},resize:function(_31){if(_31){_7.set(this.domNode,{"width":_31.w+"px","height":_31.h+"px"});if(_31.w&&_31.h&&this.containerLayout){this.containerLayout.resize(_31);}}},validate:function(){return this._uiSetUp&&this.form.validate();},_beforeSetFocus:function(_32){if(this._widgetMap[_32.id]){var _33=this._widgetMap[_32.id].parent;var _34=this._widgetMap[_32.id].group;this._beforeSetFocus(_33);_33.selectChild(_34);}}});});