//>>built
define("epi/ModuleManager",["dojo","dojo/DeferredList","epi/clientResourcesLoader","epi/routes"],function(_1,_2,_3,_4){return _1.declare("epi.ModuleManager",null,{_allModules:null,_moduleInstances:null,_modulesConfigured:false,constructor:function(_5){this._allModules={};this._moduleInstances={};for(var i=0;i<_5.length;i++){var _6=_5[i];this._allModules[_6.name]=_6;}},getModule:function(_7){return this._allModules[_7];},configureModules:function(){if(this._modulesConfigured){return;}this._modulesConfigured=true;for(var _8 in this._allModules){this._configureModule(this._allModules[_8]);}},startModules:function(_9){this.configureModules();if(_9){return this._startModule(this._allModules[_9]);}else{var _a=[];for(name in this._allModules){_a.push(this._startModule(this._allModules[name]));}return new _2(_a);}},_startModule:function(_b){if(_b._started){return _b._started;}_b._started=new _1.Deferred();var _c=this;_1.when(this._startRequiredModules(_b),function(){var _d=_3.loadResources(_b.cssResources,_b.scriptResources);_1.when(_d,function(){_c._runModuleInitializer(_b).then(_b._started.resolve,_b._started.reject);});});return _b._started;},_startRequiredModules:function(_e){var _f=_e.moduleDependencies;var _10=[];if(_1.isArray(_f)&&_f.length){_10=_1.map(_f,function(_11){var _12=this._allModules[_11];if(!_12){throw new Error("Module '"+_e.name+"' has a dependency named '"+_11+"' which doesn't exist");}return this._startModule(_12);},this);}return new _2(_10);},_configureModule:function(_13){function _14(_15){for(var i in _15){if(_15.hasOwnProperty(i)){_1.registerModulePath(i,_15[i]);}}};_14(_13.namespaceToPathMappings);if(_13.routes){_1.forEach(_13.routes,function(_16){_4.registerRoute(_16.routeBasePath,_16.routeDefaults);});}},_runModuleInitializer:function(_17){var dfd=new _1.Deferred();if(_17.initializer){var _18=_17.initializer.replace(/\./g,"/");require([_18],_1.hitch(this,function(_19){try{var _1a=new _19(_17);_1a.initialize();this._moduleInstances[_17.name]=_1a;dfd.resolve();}catch(e){console.error(e.stack||e);dfd.reject(e);}}));}else{dfd.resolve();}return dfd;},unInitializeModule:function(_1b){var _1c=this._moduleInstances;_1c[_1b].uninitialize();delete _1c[_1b];}});});