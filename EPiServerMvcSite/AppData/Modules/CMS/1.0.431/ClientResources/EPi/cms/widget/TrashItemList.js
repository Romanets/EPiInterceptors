//>>built
require({cache:{"url:epi/cms/widget/templates/TrashItemList.html":"<div>\r\n    <div class=\"epi-trashHeader clearfix\">\r\n        <div class=\"epi-gadgetInnerToolbar\" data-dojo-attach-point=\"searchBoxContainer\">\r\n            <div data-dojo-type=\"epi.shell.widget.SearchBox\" data-dojo-attach-point=\"searchBox\"></div>\r\n        </div>\r\n        <span class=\"epi-removedByContainer\">\r\n            <label for=\"removedBy_${id}\">${resources.removedby}</label>\r\n            <select data-dojo-type=\"dijit.form.Select\" data-dojo-attach-point=\"removedBy\" id=\"removedBy_${id}\" data-dojo-attach-event='onChange: _onDeletedByChange'>\r\n                <option value=\"\">${resources.any}</option>\r\n            </select>\r\n        </span>\r\n    </div>\r\n    <div data-dojo-attach-point=\"gridContainerNode\"></div>\r\n</div>"}});define("epi/cms/widget/TrashItemList",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/window","dojo/_base/Deferred","dojo/aspect","dojo/keys","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/Evented","dojo/query","dojo/html","dojo/Stateful","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Select","dojox/widget/Standby","dgrid/OnDemandGrid","dgrid/Selection","dgrid/Keyboard","dgrid/Tree","dgrid/extensions/ColumnResizer","dgrid/util/mouse","put-selector/put","epi/dependency","epi/shell/dgrid/Formatter","epi/shell/dgrid/util/misc","epi/shell/widget/SearchBox","epi/shell/widget/_ModelBindingMixin","epi/datetime","epi/username","epi/i18n!epi/cms/nls/episerver.cms.components.trash","dojo/text!./templates/TrashItemList.html"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_1a,put,_1b,_1c,_1d,_1e,_1f,_20,_21,_22,_23){return _2("epi.cms.widget.TrashItemList",[_10,_11,_12,_c,_f,_1f],{resources:null,templateString:_23,_grid:null,_observers:{},_setQueryOptionsAttr:function(_24){this._set("queryOptions",_24);this._initialize();},updateRemovedBy:function(_25){var _26=this.model.get("currentFeeder");if(this.model.isEmptyTrash){this.bindDefaultUserSelector();return;}var _27=this.store.query({referenceId:_25.query.referenceId});var _28=_3.hitch(this,function(_29,_2a,_2b){var _2c=_26.isDefaultProvider?"":_26.name;_5.when(this.model.trashStore.query({providerName:_2c}),_3.hitch(this,function(_2d){if(_2d){var _2e=_2d.deletedByUsers;var _2f=_1.filter(this.model.get("trashes"),function(_30){return _30.wasteBasketLink===_2d.wasteBasketLink;})[0];_2f.deletedByUsers=_2e;_1.forEach(_2f.feeders,function(_31){_31.deletedByUsers=_2e;});this.bindUserSelector(_2e);}}));});var id=_26.name,_32=this._observers[id];if(_32){_32.cancel();delete this._observers[id];}this._observers[id]=_27.observe(_28,true);},destroy:function(){for(var id in this._observers){this._observers[id].cancel();delete this._observers[id];}if(this._standby){this._standby.destroyRecursive();this._standby=null;}if(this._grid){this._grid.destroy();this._grid=null;}this.inherited(arguments);},clearSelection:function(){this._grid.clearSelection();this._grid._lastSelected=null;},postMixInProperties:function(){this.resources=this.resources||_22;var _33=_1b.resolve("epi.cms.Application");this._typeDescriptor=_33.getTypeUIDescriptors();},postCreate:function(){this.inherited(arguments);this.bindUserSelector(this.model.get("currentFeeder").deletedByUsers);this.searchBox.encodeSearchText=true;this.searchBox.on("searchBoxChange",_3.hitch(this,function(_34){this.emit("searchBoxChange",_34);}));this.removedBy._updateSelection=function(){this._set("value",this._getValueFromOpts());var val=this.value;if(!_3.isArray(val)){val=[val];}_1.forEach(this._getChildren(),function(_35){var _36=_1.some(val,function(v){return _35.option&&(v===_35.option.value);});_8.toggle(_35.domNode,this.baseClass+"SelectedOption",_36);_35.domNode.setAttribute("aria-selected",_36);},this);};},resize:function(){if(this._grid){var top=_a.position(this._grid.domNode).y;var _37=_a.position(_4.body()).h;_b.set(this._grid.domNode,"height",(_37-top)+"px");}},_initialize:function(){this.searchBox.set("disabled",!this.queryOptions.query.isSearchable);if(!this._grid){this._grid=this._createGrid(this.store,this.queryOptions);_9.place(this._grid.domNode,this.gridContainerNode);}else{this._showStandby(true);if(this.queryOptions){this._grid.set("queryOptions",this.queryOptions.options);this._grid.set("query",this.queryOptions.query);}}this.resize();},bindDefaultUserSelector:function(){this.removedBy._onChangeActive=false;this.removedBy.removeOption(this.removedBy.options);this.removedBy.addOption({label:this.resources.any,value:""});this.removedBy._onChangeActive=true;},bindUserSelector:function(_38){if(_38){var _39=this.removedBy.get("value");this.bindDefaultUserSelector();this.removedBy._onChangeActive=false;_1.forEach(_38,function(_3a){this.removedBy.addOption({label:this._createUserFriendlyUsername(_3a),value:_3a});},this);this.removedBy.set("value",_39);this.removedBy._onChangeActive=true;}},_createGrid:function(_3b,_3c){var _3d=_2([_15,_16,_17,_1c,_19]);var _3e=new _3d({store:_3b,columns:{name:_18({field:"name",label:_22.name,renderCell:_3.hitch(this,this._renderTreeNode)}),removedOn:{field:"deleted",label:_22.removedon,formatters:[this._localizeDate,_1d.ellipsis]},by:{field:"deletedBy",label:_22.by,formatters:[this._createUserFriendlyUsername,_1d.ellipsis]},action:{label:" ",formatter:this._renderActionMenu,sortable:false}},minWidth:100,noDataMessage:this._getNoDataMessage(),selectionMode:"single"});this._standby=new _14({target:_3e.domNode}).placeAt(document.body);this._standby.startup();_6.after(_3e,"_processScroll",_3.hitch(this,function(){this._showStandby(false);}));this._showStandby(true);_6.before(_3e,"adjustRowIndices",function(_3f){if(_3f){_1.forEach(_d("div.dgrid-no-data",this.contentNode),function(div){_e.set(div,"");});}});_6.before(_3e,"renderArray",_3.hitch(this,function(_40,_41,_42){var _43=this.queryOptions.query;if(_43&&_43.query==="searchcontent"){_40.map(function(_44){if(_44){_44.hasChildren=false;}});}}));if(_3c){_3e.set("queryOptions",_3c.options);_3e.set("query",_3c.query);}var _45="epi-dgrid-mouseover";_3e.on(_1a.enterRow,function(evt){_8.add(this,_45);});_3e.on(_1a.leaveRow,function(evt){_8.remove(this,_45);});_3e.on(".epi-gridAction:click",_3.hitch(this,function(evt){var row=_3e.row(evt);this.emit("itemClick",row);}));_3e.on(".dgrid-column-action:keydown",_3.hitch(this,function(e){if(e.keyCode==_7.ENTER&&!e.shiftKey&&!e.altKey&&!e.ctrlKey){var row=_3e.row(e);this.emit("itemClick",row);}}));return _3e;},_renderTreeNode:function(_46,_47,td,_48){var _49="epi-iconObjectPage";if(_47&&this._typeDescriptor&&_46.typeIdentifier){var _4a=this._typeDescriptor[_46.typeIdentifier];if(_4a.iconClass){_49=_4a.iconClass;}}_9.place(_1d.icon(_49+" epi-objectIcon",_1d.ellipsis(_1d.htmlEncode(_47))),td);},_renderActionMenu:function(_4b){var _4c={"title":_22.restore.tooltip,"label":_22.restore.label};return _3.replace("<a class=\"epi-gridAction\" title=\"{title}\">{label}</a>",_4c);},_localizeDate:function(_4d){return _20.toUserFriendlyString(_4d);},_createUserFriendlyUsername:function(_4e){return _21.toUserFriendlyString(_1d.htmlEncode(_4e));},_onDeletedByChange:function(_4f){if(this.model.isEmptyTrash){this.model.isEmptyTrash=false;return;}this.emit("deletedByChange",_4f);},_showStandby:function(_50){if(!this._standby){return;}if(_50){if(!this._standby.isVisible()){this._standby.show();}}else{this._standby.hide();}},_getNoDataMessage:function(){return "<span><span class=\"dijitReset dijitInline\">"+_22.trashitemempty+"</span></span>";}});});