//>>built
require({cache:{"url:epi/cms/widget/templates/ContentReferences.html":"<div class=\"epi-contentReferences\">\r\n    <div class=\"epi-dialog-captionPanel\" data-dojo-attach-point=\"captionPanelNode\">\r\n        <div class=\"epi-floatRight\" data-dojo-type=\"dijit.Toolbar\" dojo-data-attach-point=\"contentReferenceToolbar\">\r\n            <button data-dojo-type=\"dijit.form.Button\" data-dojo-attach-point=\"saveListButton\" data-dojo-attach-event=\"onClick:_refreshList\"\r\n                    data-dojo-props=\"iconClass:'epi-iconReload', 'class':'epi-chromelessButton'\">${res.buttons.refresh}</button>\r\n        </div>\r\n        <h1>\r\n            <span class='dijitInline dijitIcon epi-iconObjectSharedBlock'>&nbsp;</span><span class='dijitInline dojoxEllipsis' data-dojo-attach-point=\"contentReferencesWidgetTitleNode\"></span>\r\n        </h1>\r\n    </div>\r\n    <div class=\"epi-verticalScroller\">\r\n        <div data-dojo-attach-point=\"pageGridContainer\">\r\n            <h2 data-dojo-attach-point=\"pageTitleNode\"></h2>\r\n            <div data-dojo-attach-point=\"pageGrid\" ></div>\r\n        </div>\r\n        <div data-dojo-attach-point=\"blockGridContainer\">\r\n            <h2 data-dojo-attach-point=\"blockTitleNode\"></h2>\r\n            <div data-dojo-attach-point=\"blockGrid\"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n"}});define("epi/cms/widget/ContentReferences",["dojo/_base/event","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/dom-style","dojo/dom-class","dojo/string","dojo/store/Memory","dojo/topic","dojo/dom-attr","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/form/Button","dijit/Toolbar","dojox/html","dojox/html/entities","dgrid/OnDemandGrid","dgrid/Selection","dgrid/Keyboard","epi","epi/string","epi/shell/widget/_ModelBindingMixin","epi/shell/dgrid/Formatter","epi/Url","dojo/text!./templates/ContentReferences.html","epi/i18n!epi/cms/nls/episerver.cms.widget.contentreferences","epi/i18n!epi/cms/nls/episerver.cms.confirmation.references"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,epi,_15,_16,_17,Url,_18,res,_19){var _1a=_2([_12,_13,_14,_17]);return _2("epi.cms.widget.ContentReferences",[_b,_c,_d,_16],{res:res,dialogResources:null,templateString:_18,dialog:null,modelBindingMap:{"numberOfReferences":["numberOfReferences"],"pageReferences":["pageReferences"],"blockReferences":["blockReferences"],"isLoading":["isLoading"],"showToolbar":["showToolbar"]},_setContentReferencesWidgetTitleAttr:function(_1b){_10.set(this.contentReferencesWidgetTitleNode,_11.encode(_1b));_a.set(this.contentReferencesWidgetTitleNode,"title",_1b);},_setPageTitleAttr:{node:"pageTitleNode",type:"innerHTML"},_setBlockTitleAttr:{node:"blockTitleNode",type:"innerHTML"},_setNumberOfReferencesAttr:function(_1c){if(this.model.mode==="confirm"){this.dialog.set("description",_15.toHTML(_1c.total>0?this.dialogResources.referenceswarning:this.dialogResources.noreferencesnote));}if(_1c.total>0){this.set("contentReferencesWidgetTitle",_3.replace((_1c.total>1?res.usages:res.usage),[this.model.contentData.name,_1c.total]));this.set("pageTitle",_3.replace((_1c.page>1?res.pages:res.page),[_1c.page]));this.set("blockTitle",_3.replace((_1c.block>1?res.blocks:res.block),[_1c.block]));this.dialog.resize({w:700});this.dialog.layout();}},_setPageReferencesAttr:function(_1d){if(!this.model.isLoading){_5.set(this.pageGridContainer,"display",_1d.length>0?"":"none");}var _1e=new _8({data:_1d,idProperty:"ownerContentLink"});this.pageGrid.set("store",_1e);},_setBlockReferencesAttr:function(_1f){if(!this.model.isLoading){_5.set(this.blockGridContainer,"display",_1f.length>0?"":"none");}var _20=new _8({data:_1f,idProperty:"ownerContentLink"});this.blockGrid.set("store",_20);},_setShowToolbarAttr:function(_21){_5.set(this.captionPanelNode,"display",_21?"":"none");},_setIsLoadingAttr:function(_22){if(_22){this.set("contentReferencesWidgetTitle",this.model.contentData?this.model.contentData.name:"");this.set("pageTitle",res.page.substring(0,res.page.indexOf("({0})")));this.set("blockTitle",res.block.substring(0,res.block.indexOf("({0})")));this.model.set("pageReferences",{});this.model.set("blockReferences",{});}},postMixInProperties:function(){this.inherited(arguments);this._setupDialog();},buildRendering:function(){this.inherited(arguments);this.pageGrid=this._setupGrid(this.pageGrid,"epi-iconPage",true);this.blockGrid=this._setupGrid(this.blockGrid,"epi-iconObjectSharedBlock",false);},uninitialize:function(){this.pageGrid.destroy();this.blockGrid.destroy();},_setupGrid:function(_23,_24,_25){var _26,_27={columns:{ownerName:{field:"ownerName",ellipsisNoTooltip:true,icon:_24,get:function(_28){return _11.encode(_28.ownerName);},className:"epi-width35"},path:{field:_25?"ownerPublicUrl":"ownerTreePath",htmlEncode:true,ellipsis:true,className:"epi-width50"},edit:{field:"edit",renderCell:function(_29,_2a,_2b,_2c){var _2d={"url":new Url(window.location.href).path+"#context=epi.cms.contentdata:///"+_29.ownerContentLink,"title":_25?res.editpagetitle:res.editblocktitle,"edit":epi.resources.action.edit};_2b.innerHTML=_3.replace("<a class=\"epi-floatRight\" href=\"{url}\" title=\"{title}\" target=\"_blank\" tabindex=\"-1\">{edit}</a>",_2d);}}},showHeader:false,selectionMode:"single",cellNavigation:false,noDataMessage:res.loading};_26=new _1a(_27,_23);_26.on(".dgrid-cell a:click",_3.hitch(this,function(e){if(!e.ctrlKey){this._contextRequest(_26,e);}}));_26.on(".dgrid-row:keydown",_3.hitch(this,function(e){if(e.keyCode==dojo.keys.ENTER&&!e.shiftKey&&!e.altKey&&!e.ctrlKey){this._contextRequest(_26,e);}}));_26.on("focusin",_3.hitch(this,function(e){this._selectRow(_26,e);}));_26.on("focusout",function(e){_26.clearSelection();});return _26;},_setupDialog:function(){this.dialogResources=_19[this.model.get("contentDataType")];if(this.model.get("mode")==="confirm"){this.dialog.set("title",this.dialogResources.title);this.dialog.set("description",_15.toHTML(this.dialogResources.question));var _2e=this.model.numberOfReferences.total===0?epi.resources.action.ok:epi.resources.action.moveanyway;this.dialog.set("confirmActionText",_2e);this.dialog.set("cancelActionText",epi.resources.action.cancel);this.dialog.set("setFocusOnConfirmButton",this.model.numberOfReferences.total===0);}else{this.dialog.set("title",this.res.title);}},_refreshList:function(){_4.when(this.model.update(),_3.hitch(this,function(){_5.set(this.pageGridContainer,"display",this.model.pageReferences&&this.model.pageReferences.length>0?"":"none");_5.set(this.blockGridContainer,"display",this.model.blockReferences&&this.model.blockReferences.length>0?"":"none");}));},_contextRequest:function(_2f,e){var row=_2f.row(e),_30={uri:"epi.cms.contentdata:///"+row.data.ownerContentLink};_1.stop(e);_9.publish("/epi/shell/context/request",_30,{sender:this});this.dialog.onCancel();},_selectRow:function(_31,e){_31.clearSelection();var row=_31.row(e);if(row){_31.select(row);}}});});