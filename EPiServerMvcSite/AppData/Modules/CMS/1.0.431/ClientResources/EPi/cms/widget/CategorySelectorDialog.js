//>>built
define("epi/cms/widget/CategorySelectorDialog",["epi","dojo","dijit","dojo/i18n","dijit/_Widget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","epi/cms/widget/CategoryTree","dijit/form/Button","epi/dependency"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){return _2.declare("epi.cms.widget.CategorySelectorDialog",[_5,_6,_7],{templateString:"<div class=\"epi-categorySelectorDialog\">                            <div data-dojo-attach-point=\"tree\" data-dojo-type=\"epi.cms.widget.CategoryTree\" data-dojo-attach-event=\"onOpen: _onOpen, onClose: _onClose\"></div>                         </div>",_categories:null,_categoriesParentsName:{},postCreate:function(){this.inherited(arguments);this.connect(this.tree,"onTreeNodeCheckBoxChange",_2.hitch(this,this._onCategoryCheckBoxChange));this.connect(this.tree,"onTreeNodeCreated",_2.hitch(this,this._onCategoryNodeCreated));},_onCategoryNodeCreated:function(_b,_c){if(this._categories==null){return;}var _d=this._categories.indexOf(_c.id)!=-1;_b.setCheckAttribute(_d);if(!_c.hasChildren){return;}this._updateSelectedChildrenCount(_c,_b);},_onCategoryCheckBoxChange:function(_e,_f){var _10=this._categories.indexOf(_f.id);var _11=_10!=-1;var _12=this.tree.getTreeNodeById(_f.id);if(_12==null){return;}var _13=_12.getParent();if(_e&&!_11){while(_13!=this.tree.rootNode){this._incrementSelectedCount(_13);_13=_13.getParent();}this._incrementSelectedCount(this.tree.rootNode);this._categories.push(_f.id);this._categoriesParentsName[_f.id]=_f.parentsNameCollection;}if(!_e&&_11){while(_13!=this.tree.rootNode){this._decrementSelectedCount(_13);_13=_13.getParent();}this._decrementSelectedCount(this.tree.rootNode);this._categories.splice(_10,1);this._categoriesParentsName[_f.id]={};}},_onOpen:function(_14,_15){_15.updateLabel();},_onClose:function(_16,_17){_17.updateLabel();},_setSelectedCount:function(_18,_19){if(_18==null){return;}_18.setSelectedChildrenCount(_19);},_incrementSelectedCount:function(_1a){if(_1a==null){return;}var _1b=this._getSelectedCount(_1a);this._setSelectedCount(_1a,_1b+1);},_decrementSelectedCount:function(_1c){if(_1c==null){return;}var _1d=this._getSelectedCount(_1c);this._setSelectedCount(_1c,_1d-1);},_getSelectedCount:function(_1e){if(_1e==null){return 0;}return _1e.getSelectedChildrenCount();},_updateSelectedChildrenCount:function(_1f,_20){var _21=0;_2.forEach(this._categories,_2.hitch(this,function(_22){if(_1f.id!=_22){var _23=false;var _24=this._categoriesParentsName[_22];if(_1f.parentsNameCollection.length<_24.length){_23=true;for(i=0;i<_1f.parentsNameCollection.length;i++){if(_1f.parentsNameCollection[i]!=_24[i]){_23=false;break;}}}if(_23){_21++;}}}));this._setSelectedCount(_20,_21);},_checkCategories:function(_25){var _26=this.tree.getTreeNodeById(_25.id);if(_26==null){return;}var _27=this._categories.indexOf(_25.id)!=-1;_26.setCheckAttribute(_27);if(!_25.hasChildren){return;}this._updateSelectedChildrenCount(_25,_26);_2.forEach(_25.children,_2.hitch(this,function(_28,i){this._checkCategories(_28);}));},onShow:function(){if(this._categories==null){return;}if(this.tree&&this.tree.rootNode){this._checkCategories(this.tree.rootNode.item);}},setCategoriesParentsNameClone:function(_29){this._categoriesParentsName=_29;},_setValueAttr:function(_2a){this._categories=_2a;if(!this._categories){this._categories=[];}},_getValueAttr:function(){return this._categories;},getCategoryItemById:function(_2b){var _2c=this.tree.getTreeNodeById(_2b);if(!_2c){return null;}return _2c.item;}});});