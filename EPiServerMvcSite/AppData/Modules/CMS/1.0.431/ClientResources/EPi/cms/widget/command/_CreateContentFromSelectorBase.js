//>>built
define("epi/cms/widget/command/_CreateContentFromSelectorBase",["dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/aspect","dojo/on","dojo/topic","epi/dependency","epi/shell/command/_Command","epi/shell/widget/dialog/Dialog","epi/cms/_ContentContextMixin","epi/cms/component/ContentFilter","epi/cms/widget/ContentSelectorDialog","epi/cms/contentediting/ContentActionSupport"],function(_1,_2,_3,_4,on,_5,_6,_7,_8,_9,_a,_b,_c){return _1([_7,_9],{res:null,contentType:null,canExecute:true,canSelectOwnerContent:false,showButtons:false,expandSubRoot:true,value:null,showRoot:false,typeIdentifiers:null,modelContent:null,destroyOnHide:true,confirmActionText:null,description:null,title:null,postscript:function(){this.inherited(arguments);this._initialize();},_execute:function(){_2.when(this.getCurrentContent(),_3.hitch(this,function(_d){if(!_d){return;}_2.when(this.contextStore.get("?uri=epi.cms.contentdata:///"+_d.contentLink),_3.hitch(this,function(_e){if(!_e){return;}var _f=_e.languageContext;var _10=!_f||(_f.hasTranslationAccess&&_f.isPreferredLanguageAvailable);var _11=!(_d.isWastebasket||_d.isDeleted)&&_10&&_c.isActionAvailable(_d,_c.action.Create,_c.providerCapabilities.Create,true);if(_d.typeIdentifier!==this.typeIdentifiers||!_11){this._createDialog();this._setDialogButtonState(this.selector.get("value"));}else{this._switchView(_d);}}));}));},_createDialog:function(){var _12={canSelectOwnerContent:this.canSelectOwnerContent,showButtons:this.showButtons,expandSubRoot:this.expandSubRoot,value:this.value,root:this.root,showRoot:this.showRoot,typeIdentifiers:this.typeIdentifiers,model:this.modelContent};this.selector=new _b(_12);var _13={destroyOnHide:this.destroyOnHide,confirmActionText:this.confirmActionText,description:this.description,title:this.title,content:this.selector};this.dialog=new _8(_13);on(this.selector,"change",_3.hitch(this,this._setDialogButtonState));_4.after(this.dialog,"hide",_3.hitch(this,function(_14){this.hideDeferred=_14;}));this.dialog.on("execute",_3.hitch(this,this._onContentSelected));this.dialog.show();},_initialize:function(){if(this._initialized){return;}var _15=_6.resolve("epi.cms.Application"),_16=_6.resolve("epi.storeregistry");this.contentStore=_16.get("epi.cms.content.light");this.contextStore=_16.get("epi.shell.context");this.application=_15;this._initialized=true;},_onContentSelected:function(){var _17=this.selector.get("value");_2.when(this.hideDeferred,_3.hitch(this,function(){_2.when(this.contentStore.get(_17),_3.hitch(this,function(_18){this._switchView(_18);}));}));},_switchView:function(_19){_5.publish("/epi/shell/action/changeview","epi/cms/component/CreateContent",null,{requestedTypes:[this.contentType],res:this.res,type:this.contentType,parent:_19});},_setDialogButtonState:function(_1a){_2.when(this.contentStore.get(_1a),_3.hitch(this,function(_1b){_2.when(this.contextStore.get("?uri=epi.cms.contentdata:///"+_1b.contentLink),_3.hitch(this,function(_1c){var _1d=_1c.languageContext;var _1e=!_1d||(_1d.hasTranslationAccess&&_1d.isPreferredLanguageAvailable);var _1f=_1e&&_c.hasAccess(_1b.accessMask,_c.accessLevel.Create);this.dialog.definitionConsumer.setItemProperty(this.dialog._okButtonName,"disabled",!_1f);}));}));}});});