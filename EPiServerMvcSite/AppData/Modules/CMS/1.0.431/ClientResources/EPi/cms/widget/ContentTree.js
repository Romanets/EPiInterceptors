//>>built
define("epi/cms/widget/ContentTree",["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/DeferredList","dojo/keys","dojo/dom-style","dojo/has","epi/dependency","epi/shell/widget/Tree","epi/shell/dnd/tree/dndSource","epi/cms/core/ContentReference","epi/cms/widget/ContentTreeStoreModel","epi/cms/widget/ContentTreeModelConfirmation","epi/cms/widget/_ContentTreeNode"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f){return _2("epi.cms.widget.ContentTree",[_a],{root:null,nodeConstructor:null,typeIdentifiers:null,allowManipulation:true,_typeDescriptor:null,_missingSelection:null,postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.model=new _d({root:this.root,typeIdentifiers:this.typeIdentifiers});this.persist=false;}if(this.allowManipulation){this.dndController=_b;}this.nodeConstructor=this.nodeConstructor||_f;var _10=_9.resolve("epi.cms.Application");if(_10){this._typeDescriptor=_10.getTypeUIDescriptors();}},buildRendering:function(){this.model=_e(this.model);this.inherited(arguments);},_setAllowManipulationAttr:function(_11){this._set("allowManipulation",_11);if(_11){this.dndController=_b;}},_onItemDelete:function(_12,_13){function _14(_15,_16){_1.forEach(_15.getChildren(),function(_17){_16.push(_17.item);_14(_17,_16);});return _16;};if(_13){var _18=this._itemNodesMap[this.model.getIdentity(_12)],_19=this;if(_18){_1.forEach(_18,function(_1a){var _1b=_14(_1a,[]).reverse();_1.forEach(_1b,function(_1c){_19._onItemDelete(_1c);});});}}this.inherited(arguments);},_setRootAttr:function(_1d){this._set("root",_1d);if(this.model&&!_4.isArray(_1d)){this.model.root=_1d;}},_setTypeIdentifiersAttr:function(_1e){this._set("typeIdentifiers",_1e);if(this.model){this.model.typeIdentifiers=_1e;}},buildNodeFromTemplate:function(_1f){return new this.nodeConstructor(_1f);},_createTreeNode:function(_20){var _21=_4.mixin({},_20,{dndData:_20.item});var _22=this.buildNodeFromTemplate(_21);return _22;},getIconClass:function(_23,_24){var _25="epi-iconObjectPage";if(this._typeDescriptor&&_23.typeIdentifier){var _26=this._typeDescriptor[_23.typeIdentifier];if(_26&&_26.iconClass){_25=_26.iconClass;}}var _27=_23.typeIdentifier==="epi.cms.folder";if(_24&&!_23.isSubRoot&&_27){_25=_25+"Open";}return _25;},focus:function(){var _28=this.get("selectedNode");if(_28){this.focusNode(_28);}else{if(this.rootNode){this.focusNode(this.rootNode);}}},_onItemChildrenChange:function(_29,_2a){this.inherited(arguments);if(this._missingSelection){var _2b=this.model.getIdentity(this._missingSelection),_2c=this.model;if(_1.some(_2a,function(_2d){return _2c.getIdentity(_2d)===_2b;})){this.selectContent(this._missingSelection);}}},selectContent:function(_2e,_2f){var _30=new _3();if(_2e){this.model.getAncestors(_2e,_4.hitch(this,function(_31){var _32;var _33=_1.map(_31,function(p){return this.model.getIdentity(p);},this);_32=this.model.getIdentity(_2e);var _34=new _c(_32);_33.push(_34.createVersionUnspecificReference().toString());this._missingSelection=_2e;this.set("paths",[_33]).then(_4.hitch(this,function(_35){var _36=_35&&_35[0]&&_35[0][0];if(_36){this._missingSelection=null;var _37=_35[0][1];if(!this.get("selectedNode")){this._set("selectedNode",_37);}if(_2f===true){this.focusNode(_37);}_30.resolve(_37);}else{_30.resolve(null);}}));}));}else{this.set("paths",[]);_30.resolve(null);}return _30;},resize:function(_38){this.inherited(arguments);if(_8("ie")>8){var _39=_7.get(this.domNode,"display");_7.set(this.domNode,"display","none");_7.set(this.domNode,"display",_39);}},_onKeyPress:function(e){this.inherited(arguments);if(!this.allowManipulation){return;}if(dojo.isCopyKey(e)){switch(e.charOrCode){case "c":case "C":this._onCopyOrCut(true);break;case "x":case "X":this._onCopyOrCut(false);break;case "v":case "V":this._onPaste();break;default:break;}}if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey){return;}if(e.charOrCode==_6.DELETE){this._onDelete();}},_onCopyOrCut:function(_3a){},_onPaste:function(){},_onDelete:function(){}});});