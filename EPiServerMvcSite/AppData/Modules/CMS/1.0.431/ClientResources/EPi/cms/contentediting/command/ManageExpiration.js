//>>built
define("epi/cms/contentediting/command/ManageExpiration",["dojo/_base/connect","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","epi","epi/cms/contentediting/ExpirationDialog","epi/cms/contentediting/viewmodel/ExpirationDialogViewModel","epi/dependency","epi/i18n!epi/cms/nls/episerver.cms.widget.expirationeditor","epi/i18n!epi/cms/nls/shell.common.buttons","epi/shell/command/_Command","epi/shell/widget/dialog/Dialog"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c){return _2([_b],{label:_9.dialogtitle,tooltip:_9.dialogtitle,viewModel:null,cssClass:"epi-chromelessButton epi-visibleLink",constructor:function(){this._metadataManager=_8.resolve("epi.shell.MetadataManager");},_execute:function(){if(!this._metadata){return;}var _d=this.get("viewModel");var _e=new _6({metadata:this._metadata,value:_d.get("value"),model:_d});var _f=new _c({destroyOnHide:true,defaultActionsVisible:false,confirmActionText:_a.save,content:_e,title:_9.dialogtitle});_f.connect(_f,"onExecute",_4.hitch(this,function(){this._onSave(_f);}));_f.connect(_f,"onCancel",_4.hitch(this,function(){this._onCancel(_f);}));_f.show();},_onModelChange:function(){var _10=this.model.contentData.properties,_11=_10.iversionable_expire;this.set("viewModel",new _7({contentLink:this.model.contentLink,contentName:this.model.contentData.name,value:_11,minimumExpireDate:_10.iversionable_startpublish}));var _12=this.get("model");_3.when(_12.getPropertyMetaData("iversionable_expire"),_4.hitch(this,function(_13){this._metadata=_13;}));this.set("canExecute",this.model&&this.model.canChangeContent());},_onSave:function(_14){var _15=_14.content.model,_16=_15.get("intermediateValue");_15.set("value",_16);var _17=this.get("model");if(!_17.contentData.capabilities.isPage){_17.publishProperty("iversionable_expire",_16);return;}var _18=_17.contentData.properties.iversionable_expire;var now=new Date();var _19=_16.stopPublish?new Date(_16.stopPublish):null;var _1a=_18.stopPublish?new Date(_18.stopPublish):null;if((_19&&_19-now<0&&(!_1a||_1a-now>0))||((!_19||_19-now>0)&&_1a&&_1a-now<0)){var _1b=_17.contentModel.watch("iversionable_expire",_4.hitch(this,function(){_1b.unwatch();_1.publish("/epi/cms/action/pageexpirationchange",[_17.contentData.contentLink]);}));}_17.publishProperty("iversionable_expire",_16);},_onCancel:function(_1c){var _1d=_1c.content.model;_1d.set("intermediateValue",_1d.get("value"));}});});