//>>built
require({cache:{"url:epi/cms/component/templates/SharedBlocks.html":"<div>\r\n    <div class=\"epi-gadgetInnerToolbar\" data-dojo-attach-point=\"searchBoxContainer\">\r\n        <div data-dojo-type=\"epi.cms.widget.SearchBox\" data-dojo-attach-point=\"searchBox\" ></div>\r\n    </div>\r\n    <div data-dojo-attach-point=\"container\" data-dojo-type=\"dijit.layout.BorderContainer\" class=\"epi-sharedBlockContainer\">\r\n        <div data-dojo-type=\"dijit.layout.ContentPane\" data-dojo-props=\"splitter:false, region:'center'\" class=\"epi-widgetResizeContent epi-secondaryGadgetContainer epi-gadgetTopContainer\" data-dojo-attach-point=\"folderContainerNode\">\r\n            <div data-dojo-attach-point=\"folderList\" data-dojo-type=\"epi.cms.widget.FolderList\"></div>\r\n        </div>\r\n        <div data-dojo-type=\"dijit.layout.ContentPane\" class=\"epi-blockContainer\" data-dojo-props=\"region:'bottom', splitter:true\">\r\n            <div data-dojo-attach-point=\"blockList\" data-dojo-type=\"epi.cms.widget.BlockList\" ></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n"}});define("epi/cms/component/SharedBlocks",["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/_base/connect","dojo/_base/Deferred","dojo/dom-geometry","dojo/dom-class","dijit/_Widget","dijit/layout/_LayoutWidget","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dijit/Tree","dijit/layout/BorderContainer","dijit/layout/ContentPane","epi","epi/dependency","epi/UriParser","epi/shell/ClipboardManager","epi/shell/command/_WidgetCommandProviderMixin","epi/shell/command/OptionCommand","epi/shell/widget/layout/ComponentContainer","epi/cms/_ContentContextMixin","epi/cms/command/NewContent","epi/cms/component/ContentFilter","epi/cms/component/command/ViewTrash","epi/cms/widget/FolderList","epi/cms/widget/BlockList","epi/cms/widget/SearchBox","epi/shell/widget/_FocusableMixin","dojo/text!./templates/SharedBlocks.html","epi/i18n!epi/cms/nls/episerver.cms.components.createblock"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_1a,_1b,_1c,_1d,_1e,_1f){var _20={rootMenu:0,folderMenu:1,blockMenu:2};var _21={folderType:3,blockType:4};return _1("epi.cms.component.SharedBlocks",[_8,_9,_a,_b,_13,_16],{_tree:null,templateString:_1e,_copyModeBlock:"SharedBlocks.CopyMode.Block",_copyModeFolder:"SharedBlocks.CopyMode.Folder",_copyMode:null,_clipboardManager:null,_currentFolder:null,_folderMenuType:null,_application:null,typeIdentifiers:["epi.cms.folder","epi.cms.block"],_componentsController:null,_widgetResizeHandle:null,postMixInProperties:function(){this._componentsController=_10.resolve("epi.shell.controller.Components");this._application=this._application||_10.resolve("epi.cms.Application");this.inherited(arguments);},postCreate:function(){this.inherited(arguments);this.searchBox.set("area","cms/blocks");_5.when(this._getFolderRoots(),_3.hitch(this,function(_22){this.searchBox.set("searchRoots",_22.join(","));}));this.searchBox.onItemAction=_3.hitch(this,function(_23){var _24=_23.metadata;this._highlightSelectedBlock(_24.id,_24.parentId);});this.connect(this.folderList,"onFolderChanged",this._onFolderChanged);this.connect(this.folderList,"onResize",_3.hitch(this,this._onResize));this.connect(this.blockList,"onSelectionChange",this._onBlockChanged);this._initCommonComponents();this._clipboardManager.watch("data",_3.hitch(this,this._onClipboardChanged));},startup:function(){if(this._started){return;}this.inherited(arguments);this._newCommand=new _17({contentType:_18.BlockType,iconClass:"epi-iconPlus",label:_1f.command.label,resources:_1f});this.add("commands",this._newCommand);this.blockList.set("createCommand",this._newCommand);this.add("commands",new _19({typeIdentifiers:this.typeIdentifiers}));_5.when(this.getCurrentContent(),_3.hitch(this,function(_25){this.contentContextChanged(_3.mixin(_25,{id:_25.contentLink}),this);}));this.connect(this.getParent(),"onResize","_onResize");},restore:function(){this.resize();},_onResize:function(){this.resize({h:_6.getMarginBox(this.domNode).h});this.onResize();},onResize:function(){},resize:function(_26){this.inherited(arguments);var _27=_6.getMarginBox(this.searchBoxContainer);this.container.resize({h:_26.h-_27.h});},_onFolderChanged:function(_28){this.blockList.set("selectedFolder",_28.item);this._newCommand.set("model",_28.item);this._folderMenuType=_28.isRootNode?_20.rootMenu:_20.folderMenu;this.toggleContext(this._folderMenuType);this._toggleActive(this.folderList,this.blockList);},_onBlockChanged:function(_29){if(_29){this.toggleContext(_20.blockMenu);}else{this.toggleContext(this._folderMenuType?this._folderMenuType:_20.rootMenu);if(this.blockList.currentContext){this._highlightSelectedBlock(this.blockList.currentContext.id,this.blockList.currentContext.parentLink);}}this._toggleActive(this.blockList,this.folderList);},_toggleActive:function(_2a,_2b){_7.remove(_2b.domNode,"epi-focused");_7.add(_2a.domNode,"epi-focused");},contentContextChanged:function(_2c,_2d){if(!_2c||!_2c.id||!_2c.capabilities||!_2c.capabilities.isBlock){return;}var _2e=_2c;_5.when(this.folderList.highlightNode(_2e.parentLink),_3.hitch(this,function(){this.blockList.set("currentContext",_2e);_5.when(this.getCurrentContent(),_3.hitch(this,function(_2f){if(_2f.isDeleted===true){this.folderList.highlightNode(this.folderList.siteBlockFolder);return;}this.blockList.highlightItem(_2f.contentLink);this.blockList.onSelectionChange(_2f);}));}));},_initCommonComponents:function(){this._initClipboard();},_initClipboard:function(){this._clipboardManager=new _12();this.folderList._tree.clipboardManager=this._clipboardManager;this.blockList.clipboardManager=this._clipboardManager;},_clearClipboard:function(){if(this._clipboardManager){this._clipboardManager.clear();}},_canPaste:function(_30){var _31=this.blockList.selectedFolder;if(!_30.item){return _31.contentLink!==_30.parentLink;}var _32=_30.item||page;if(_31.contentLink===_32.parentLink){return false;}},toggleContext:function(_33){switch(_33){case _20.rootMenu:this.blockList.hideCommands();this.folderList.showCommands(true);break;case _20.folderMenu:this.blockList.hideCommands();this.folderList.showCommands(false);break;case _20.blockMenu:this.blockList.showCommands();this.folderList.hideCommands();break;default:break;}},_toggleMenuItem:function(_34,_35,_36){if(_34&&_34["disableItem"]){_34["disableItem"](_35,_36);}},_getFolderRoots:function(){var _37=this._application.getSiteBlockFolder();var _38=this._application.getGlobalBlockFolder();var _39=[];if(_38){_39.push(_38);}if(_37&&!_f.areEqual(_38,_37)){_39.push(_37);}return _39;},_highlightSelectedBlock:function(_3a,_3b){if(!_3a||!_3b){return;}_5.when(this.folderList.highlightNode(_3b),_3.hitch(this,function(){this.blockList.highlightItem(_3a);}));},_onClipboardChanged:function(){var _3c=this._clipboardManager.getDataObject(),_3d=_3c!=null?_3c[0].data:null;if(this._previousCutItem!=null){if(this._previousCutItem.contentTypeID==_21.folderType){this.folderList.toggleCuttingNodeUI(this._previousCutItem,false);}else{this.blockList.toggleCuttingRowUI(this._previousCutItem,false);}}if(!this._clipboardManager.isCopy()&&_3d!=null){this._previousCutItem=_3d;if(this._previousCutItem.contentTypeID==_21.folderType){this.folderList.toggleCuttingNodeUI(this._previousCutItem,true);}else{this.blockList.toggleCuttingRowUI(this._previousCutItem,true);}}else{this._previousCutItem=null;}}});});