//>>built
define("epi/cms/contentediting/_EditorWrapperBase",["epi","dojo","dojo/_base/lang","dijit","dijit/_Widget"],function(_1,_2,_3,_4,_5){return _2.declare("epi.cms.contentediting._EditorWrapperBase",[_5],{wrapperType:"",editorWidgetType:null,editorParams:null,autoSave:true,editing:false,disabled:false,blockDisplayNode:null,editorWidget:null,isModified:false,_resetValue:null,_lastSyncedValue:null,_createdEditor:false,propertyName:"",propertyDisplayName:"",iframeWithOverlay:null,overlayItem:null,contentModel:null,onStartEdit:function(_6,_7){},onValueChange:function(_8,_9){},onDoubleValueChange:function(_a,_b,_c,_d){},onCancel:function(_e){},onStopEdit:function(_f,_10,_11){},postCreate:function(){this.inherited(arguments);this.contentModel.watch(this.propertyName,_2.hitch(this,"contentModelChanged"));},destroy:function(){if(this._createdEditor&&this.editorWidget){this.editorWidget.destroyRecursive();this.editorWidget=null;}this.inherited(arguments);},contentModelChanged:function(_12,_13,_14){if(!this.editing){this.set("value",_14);}},startEdit:function(_15){this._startEdit(_15);},_startEdit:function(_16){_3.mixin(this.editorParams,_16);this.set("editing",true);this.set("isModified",false);this._resetValue=this.value;this._lastSyncedValue=this._resetValue=this.getEditorValue();this.isValid();setTimeout(_2.hitch(this,function(){this.onStartEdit(this,this.editorParams);}),0);},_stopEdit:function(_17){this.set("editing",false);this._removeEditingFeatures();setTimeout(_2.hitch(this,function(){this.onStopEdit(this,this.getEditorValue(),this._resetValue,_17);}),0);},cancel:function(){if(this.isModified){this.save(this._resetValue);}this.set("editing",false);this._removeEditingFeatures();setTimeout(_2.hitch(this,function(){this.onCancel(this);}),0);},save:function(val){this.isModified=true;this._lastSyncedValue=val;setTimeout(_2.hitch(this,function(){this.onValueChange(this,val);}),0);},doubleSave:function(val,_18,_19){this.isModified=true;this._lastSyncedValue=val;setTimeout(_2.hitch(this,function(){this.onDoubleValueChange(this,val,_18,_19);}),0);},hasBeenEdited:function(){return this.editing&&(!_1.areEqual(this.getEditorValue(),this._resetValue));},hasPendingChanges:function(){return this.editing&&(!_1.areEqual(this.getEditorValue(),this._lastSyncedValue));},tryToStopEditing:function(_1a){if(this.editing){if(this.isValid()){if(this.hasBeenEdited()){if(this.hasPendingChanges()){this.save(this.getEditorValue());}this._stopEdit(_1a);}else{this.cancel(_1a);}}else{this._onTryToStopWithInvalidValue();}}},_removeEditingFeatures:function(){},_onTryToStopWithInvalidValue:function(){},_onEditorKeyPress:function(e){if(this.autoSave&&this.editing){if(e.altKey||e.ctrlKey){return;}if(e.charOrCode==_2.keys.ESCAPE){_2.stopEvent(e);this.cancel();}else{if(e.charOrCode==_2.keys.ENTER&&e.target.tagName=="INPUT"){_2.stopEvent(e);this.tryToStopEditing(false);}}}},_onChange:function(val){if(this.autoSave&&this.editing&&this.isValid()){this.save(val);}},_onDoubleChange:function(val,_1b,_1c){if(this.autoSave&&this.editing&&this.isValid()){this.doubleSave(val,_1b,_1c);}},_onIntermediateChange:function(val){if(this.editing&&this.isValid()){this.save(val);}},getEditorWidget:function(){return this.editorWidget;},getEditorValue:function(){var ew=this.editorWidget;if(ew){return ew.get("value");}return null;},setEditorValue:function(val){var ew=this.editorWidget;if(ew&&val!==ew.get("value")){ew.set("value",val);}},_setValueAttr:function(_1d){var ew=this.editorWidget;this.setEditorValue(_1d);this._set("value",this.getEditorValue()||_1d);},isValid:function(){return (this.editorWidget&&this.editorWidget.isValid?this.editorWidget.isValid():true);},focus:function(){this.editorWidget.focus();setTimeout(_2.hitch(this,function(){if(this.editorWidget.focusNode&&this.editorWidget.focusNode.tagName=="INPUT"){_4.selectInputText(this.editorWidget.focusNode);}}),0);}});});