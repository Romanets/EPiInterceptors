//>>built
define("epi/cms/component/SiteTreeModel",["dojo/_base/array","dojo/_base/declare","dojo/_base/Deferred","dojo/_base/lang","dojo/_base/connect","dojo/cookie","epi/shell/_StatefulGetterSetterMixin"],function(_1,_2,_3,_4,_5,_6,_7){return _2([_7],{query:null,showAllLanguages:false,constructor:function(_8){this._store=_8;this.query={};_5.subscribe("/epi/cms/contentdata/updated",_4.hitch(this,function(){_3.when(this.getCurrentSite(),_4.hitch(this,function(_9){this.onItemChildrenReload({siteUrl:_9.currentSite});}));}));},getRoot:function(_a,_b){_a({});},getIdentity:function(_c){var id=this._store.getIdentity(_c);if(!id&&!_c.isLanguageNode){id="root";}return id;},onItemChildrenReload:function(_d){},mayHaveChildren:function(_e){if(!_e.isLanguageNode){return true;}return false;},getLabel:function(_f){return _f.name;},getChildren:function(_10,_11){_3.when(this._store.query(_4.mixin({siteUrl:_10.url},this.query)),_11);},_setQuery:function(q){this.query=q;this.onItemChildrenReload({});},_setShowAllLanguagesAttr:function(_12){this._set("showAllLanguages",_12);this._setQuery({allLanguages:_12});},getCurrentSite:function(){var def=new _3();var _13=_6("editlanguagebranch");if(_13){_3.when(this._store.get(),_4.hitch(this,function(_14){var _15=null;var _16=document.location.href.toLowerCase();_1.some(_14,function(_17){var _18=_16.lastIndexOf(_17.editUrl.toLowerCase(),0)===0;if(_18){_15={currentSite:_17.url,currentEditLanguageId:_17.url+_13};return true;}});if(_15){def.resolve(_15);}else{def.cancel();}}),function(){def.reject(null);});}else{def.reject(null);}return def;},getAllLanguagesForSite:function(_19){var def=new _3();_3.when(this._store.query({siteUrl:_19,allLanguages:true}),function(_1a){def.resolve(_1a);});return def;},getAllLanguagesForCurrentSite:function(){var def=new _3();_3.when(this.getCurrentSite(),_4.hitch(this,function(_1b){this.getAllLanguagesForSite(_1b.currentSite).then(function(_1c){def.resolve(_1c);});}),function(_1d){def.reject(_1d);});return def;}});});