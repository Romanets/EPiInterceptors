//>>built
define("epi/cms/contentediting/EditToolbar",["dojo","dojo/_base/lang","dojo/_base/array","dojo/DeferredList","dojo/dom-class","dojox/html/ellipsis","epi","epi/dependency","epi/shell/widget/Toolbar","epi/shell/command/withConfirmation","epi/cms/contentediting/command/Editing","epi/cms/contentediting/viewmodel/EditActionPanelViewModel","epi/i18n!epi/cms/nls/episerver.cms.contentediting.toolbar.buttons","epi/i18n!epi/cms/nls/episerver.cms.contentediting.editactionpanel.publishactionmenu","epi/cms/widget/NotificationStatusBar","epi/cms/contentediting/EditActionPanel"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e){return _1.declare("epi.cms.contentediting.EditToolbar",[_9],{res:_d,_editActionViewModel:null,_commands:null,_revertToPublished:null,_toolbarInitialized:null,_queueTasks:null,postCreate:function(){this.inherited(arguments);this._commands=_b;this._revertToPublished=_a(this._commands.revertToPublished,null,{title:_e.reverttopublishconfirmation.dialogtitle,heading:_e.reverttopublishconfirmation.confirmquestion,description:_e.reverttopublishconfirmation.description});this._commands.revertToPublished.watch("canExecute",_1.hitch(this,function(){this.setItemProperty(this._commands.revertToPublished.name,"disabled",!this._commands.revertToPublished.canExecute);}));this._editActionViewModel=new _c();this._setupToolbar();},uninitialize:function(){if(this._editActionViewModel&&this._editActionViewModel.uninitialize){this._editActionViewModel.uninitialize();}this.inherited(arguments);},resize:function(_f){this.inherited(arguments);_5.toggle(this.domNode,"epi-editToolbarNarrow",_f.w<620);_5.toggle(this.domNode,"epi-editToolbarMedium",_f.w>=620&&_f.w<1000);},_setupToolbar:function(){this._toolbarInitialized=false;var _10=[{name:"toolbarGroupContainer",type:"toolbargroup",settings:{"class":"epi-toolbarGroupContainer"}},{parent:"toolbarGroupContainer",name:"leading",type:"toolbargroup",settings:{"class":"epi-toolbarLeading epi-toolbarGroup"}},{parent:"toolbarGroupContainer",name:"center",type:"toolbargroup",settings:{"class":"epi-toolbarCenter epi-toolbarGroup"}},{parent:"toolbarGroupContainer",name:"trailing",type:"toolbargroup",settings:{"class":"epi-toolbarTrailing epi-toolbarGroup"}}];var _11=[{parent:"leading",name:"breadcrumbs",widgetType:"epi.cms.widget.Breadcrumb",settings:{showCurrentNode:false}},{parent:"leading",name:"pagename",type:"label",settings:{"class":"dojoxEllipsis"}},{parent:"center",name:"save",label:this.res.autosave.savinglabel,type:"dropdown",settings:{"class":"epi-autosave-hidden"}},{parent:"save",name:"undo",title:this.res.undo.title,label:_7.resources.action.undo,type:"menuitem",iconClass:"epi-iconUndo",settings:{disabled:true,showLabel:false},action:function(){_1.publish("/epi/cms/action/undo",[]);}},{parent:"save",name:"redo",title:this.res.redo.title,label:_7.resources.action.redo,type:"menuitem",iconClass:"epi-iconRedo",settings:{disabled:true,showLabel:false},action:function(){_1.publish("/epi/cms/action/redo",[]);}},{parent:"save",name:"reverttopublished",title:this._commands.revertToPublished.tooltip,label:this._commands.revertToPublished.label,type:"menuitem",iconClass:"epi-iconRevert",settings:{separate:true},action:_1.hitch(this,function(){this._revertToPublished.execute();})},{parent:"trailing",name:"notifications",widgetType:"epi.cms.widget.NotificationStatusBar"},{name:"editactionpanel",label:_7.resources.action.publish,parent:"trailing",widgetType:"epi.cms.contentediting.EditActionPanel",settings:{model:this._editActionViewModel}},{parent:"trailing",name:"editmodeswitch",title:this.res.formedit.title,label:this.res.formedit.label,widgetType:"dijit.form.ToggleButton",iconClass:"epi-iconForms",settings:{showLabel:false,"class":"epi-mediumButton epi-chromelessButton"},action:function(){setTimeout(function(){_1.publish("/epi/cms/action/switcheditmode");},0);}}];var _12=new _4([this.add(_10),this.add(_11)]);_12.then(_2.hitch(this,function(_13){this._toolbarInitialized=true;this._processInQueueTasks();}));},_setContentViewModelAttr:function(_14){this._set("contentViewModel",_14);if(!this._toolbarInitialized){this._pushInQueue(this._updateToolbarItems,[_14]);return;}this._updateToolbarItems(_14);},_pushInQueue:function(_15,_16){if(!this._queueTasks){this._queueTasks=[];}this._queueTasks.push({callback:_15,parameters:_16 instanceof Array?_16:[_16]});},_processInQueueTasks:function(){if(!this._queueTasks||this._queueTasks.length<=0){return;}_3.forEach(this._queueTasks,_2.hitch(this,function(_17){if(_17){_17.callback.apply(this,_17.parameters);}}));delete this._queueTasks;this._queueTasks=[];},_updateToolbarItems:function(_18){this.setItemProperty("save","label","");this.setItemVisibility("save",false);this.setItemProperty("save","class","epi-autoSaveButton epi-disabledDropdownArrow");var _19=_18.contentData;this.setItemProperty("breadcrumbs","displayAsText",_19.capabilities.isBlock);this.setItemProperty("breadcrumbs","contentLink",_19.contentLink);this.setItemProperty("pagename","label",_19.name);this.setItemProperty("notifications","page",_19);var _1a="",_1b="";if(_18.viewName==="formedit"){_1a=this.res.onpageedit.title;_1b=this.res.onpageedit.label;}else{this.setItemProperty("editmodeswitch","checked",false);_1a=this.res.formedit.title;_1b=this.res.formedit.label;}this.setItemProperty("editmodeswitch","title",_1a);this.setItemProperty("editmodeswitch","label",_1b);this.setItemVisibility("editmodeswitch",_18.hasEditAccess()&&_19.hasTemplate);this._editActionViewModel.set("dataModel",_18);}});});