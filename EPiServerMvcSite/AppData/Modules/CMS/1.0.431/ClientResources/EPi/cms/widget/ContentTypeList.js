//>>built
define("epi/cms/widget/ContentTypeList",["dojo","epi/i18n!epi/cms/nls/episerver.cms.widget.contenttypelist","dojo/DeferredList","dijit/layout/_LayoutWidget","epi/dependency","epi/cms/widget/ContentTypeGroup","epi/cms/component/ContentFilter","dojo/dom-class"],function(_1,_2,_3,_4,_5,_6,_7,_8){return _1.declare("epi.cms.widget.ContentTypeList",[_4],{store:null,parent:null,groups:null,requestedTypes:[],type:null,postMixInProperties:function(){this.inherited(arguments);this.groups={};if(!this.store){var _9=_5.resolve("epi.storeregistry");this.store=_9.get("epi.cms.contenttype");}},buildRendering:function(){this.inherited(arguments);var _a=new _6();this.connect(_a,"onSelect",this.onContentTypeSelected);this.addChild(_a);this._suggestedContentTypes=_a;},refresh:function(){this.clear();this._setupWidgetTemplate();_1.when(this._getSuggestedContentTypes(this.requestedTypes),_1.hitch(this,function(_b){if(_b.length<=0){this._suggestedContentTypes.setVisibility(false);}else{_8.add(this._suggestedContentTypes.titleNode,"epi-ribbonHeaderSpecial");this._suggestedContentTypes.set("title",this._suggestedTypesTitle);this._suggestedContentTypes.set("contentTypes",_b);this._suggestedContentTypes.setVisibility(true);}}));_1.when(this._groupContentTypes(),_1.hitch(this,function(_c){var _d,_e;for(_d in _c){_e=this._getOrCreateGroup(_d);_e.set("contentTypes",_c[_d]);}}));},_setupWidgetTemplate:function(){this._suggestedTypesTitle=_2.suggestedtypes[this.type.toLowerCase()];this._otherTypesTitle=_2.othertypes[this.type.toLowerCase()];},clear:function(){this._suggestedContentTypes.clear();for(var _f in this.groups){this.groups[_f].destroyRecursive();delete this.groups[_f];}},_getOrCreateGroup:function(_10){var _11=this.groups[_10];if(!_11){_11=new _6({title:_10});_11.connect(_11,"onSelect",this.onContentTypeSelected);this.addChild(_11);this.groups[_10]=_11;}return _11;},_getAvailableContentTypes:function(_12){return this.store.query({id:this.parent.contentTypeID,query:"getavailablecontenttypes",parentReference:this.parent.contentLink,requestedTypes:_12});},_getSuggestedContentTypes:function(_13){return this.store.query({id:this.parent.contentTypeID,query:"getsuggestedcontenttypes",parentReference:this.parent.contentLink,requestedTypes:_13});},_groupContentTypes:function(){var _14={},_15=new _1.Deferred(),_16=this._otherTypesTitle;_1.when(this._getAvailableContentTypes(this.requestedTypes),function(_17){var _18=_17.length;_1.forEach(_17,function(_19){_1.when(_19,function(_1a){var _1b=_1a.groupName||_16,_1c=_14[_1b]||[];_1c.push(_1a);_14[_1b]=_1c;_18--;if(_18===0){_15.resolve(_14);}});});});return _15;},_setParentAttr:function(_1d){this._set("parent",_1d);this.refresh();},_setRequestedTypesAttr:function(_1e){this._set("requestedTypes",_1e);},_setTypeAttr:function(_1f){this._set("type",_1f);},onContentTypeSelected:function(){}});});