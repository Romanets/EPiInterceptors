//>>built
define("epi/cms/widget/FolderTree",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/json","dijit/tree/_dndSelector","epi/cms/widget/_FolderTreeNode","epi/cms/widget/FolderTreeStoreModel","epi/cms/widget/ContentTree"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9){return _2("epi.cms.widget.FolderTree",[_9],{editorWidth:"200px",clipboardManager:null,dndController:_6,postMixInProperties:function(){this.inherited(arguments);if(!this.model){this.model=new _8({store:this.store});this.persist=false;}},postCreate:function(){this.inherited(arguments);this.connect(this.model,"select",this._selectFolderByItem);this.connect(this.model,"onChildrenChange",_3.hitch(this,this._onResize));this.connect(this.model,"onDeleted",_3.hitch(this,this._onDeleted));},checkAcceptance:function(_a){return _a===this;},_updateItemDeletedHirachy:function(_b){if(!_b){return;}_1.forEach(_b.getChildren(),function(_c){_c.set({item:_3.mixin(_c.item,{isDeleted:true})});this._updateItemDeletedHirachy(_c);},this);},_onDeleted:function(_d){var _e=this.getNodesByItem(_d);_1.forEach(_e,function(_f){this._updateItemDeletedHirachy(_f);},this);},_selectFolderByItem:function(_10){var _11=this.getNodesByItem(_10)[0];this.selectFolder(_11);},selectFolder:function(_12){if(!_12||(_12&&_12.item&&_12.item.isDeleted)){return;}this.selectContent(_12.item.contentLink,false);this.onFolderSelected(_12);},_renameFolder:function(_13,_14){var _15=new _4();var _16=_3.trim(_14);if(!_16){var _17=this.tree.getNodesByItem(_13)[0];_17.rollbackLabel(_13.name);_15.resolve();return _15;}_4.when(this.model.rename(_13.contentLink,{icontent_name:_5.stringify(_16)}),_3.hitch(this,function(_18){_15.callback(_18);var _19=this.getNodesByItem(_13)[0];var _1a=_19.getParent();_13.name=_16;this._updateChildren(_1a.item);}),_3.hitch(this,function(_1b){var _1c=this.tree.getNodesByItem(_13)[0];_1c.rollbackLabel(_13.name);_15.cancel();}));return _15;},_updateChildren:function(_1d){var _1e=new _4();var _1f=!_1d?this.get("selectedNode").item:_1d;this.model.getChildren(_1f,_3.hitch(this,function(_20){_4.when(this.model.onChildrenChange(_1f,_20),function(){_1e.callback();});}));return _1e;},_updateUI:function(_21,_22,_23,_24){var _25=new _4();if(_24){_4.when(this._updateChildren(_22),function(){_25.callback();});}else{_4.when(this._updateChildren(_23),_3.hitch(this,function(){_4.when(this._updateChildren(_22),function(){_25.callback();});}));}return _25;},blockContextChanged:function(ctx,_26){},buildNodeFromTemplate:function(_27){var _28=new _7(_27);_28.bindContextMenu(this.contextMenu);this.connect(_28,"onRename",_3.hitch(this,function(val){this._renameFolder(_28.item,val);}));this.connect(_28,"onTreeNodeSelected",_3.hitch(this,function(_29){this.onFolderSelected(_29);}));this.connect(_28,"onResize",_3.hitch(this,this._onResize));return _28;},onFolderSelected:function(_2a){},_onKeyPress:function(e){var _2b=e.target&&dijit.getEnclosingWidget(e.target);if(!_2b){return;}e.target=_2b.domNode.parentNode;this.inherited(arguments);},_onResize:function(){this.onResize();},onResize:function(){}});});